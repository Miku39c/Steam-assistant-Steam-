<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>1</title>
		<script type="text/javascript">
		"use strict";
		
		var a = void 0;
		var u = void 0;
		
		var n = function(r) {
			return r.name
		};
		
		var f = new Map;
		
		var r = function() {
			return function(r, e) {
				if (Array.isArray(r)) return r;
				if (Symbol.iterator in Object(r)) return function(r, e) {
					var t = [],
						n = !0,
						o = !1,
						i = void 0;
					try {
						for (var a, u = r[Symbol.iterator](); !(n = (a = u.next()).done) && (t.push(a.value), !e || t.length !== e); n = !
							0);
					} catch (r) {
						o = !0, i = r
					} finally {
						try {
							!n && u.return && u.return()
						} finally {
							if (o) throw i
						}
					}
					return t
				}(r, e);
				throw new TypeError("Invalid attempt to destructure non-iterable instance")
			}
		}();
		
		var e ="\n    \
		self.onmessage = function (e) {\n\
			  var data = JSON.parse(e.data)\n\
		      var method = data.method\n\
		      var params = data.params || []\n\
		      try {\n\
		        var result = self[method].apply(null, params) || null\n\
		        if (result instanceof Promise) {\n\
		          Promise.resolve(result).then(res => {\n\
		            self.postMessage(JSON.stringify(res))\n\
		          }).catch(e => {\n\
		            throw new Error(e)\n\
		          })\n\
		        } else {\n\
		          self.postMessage(JSON.stringify(result))\n\
		        }\n\
		      } catch (e) {\n\
		        throw new Error(e)\n\
		      }\n\
		    } \n  \
		";
		
		var t = function (r) {
				if ("function" == typeof r && null !== r) {
					if (r.prototype && r.prototype.constructor === r) return !1;
					if (0 !== Function.prototype.toString.call(r).indexOf("function")) return !0;
					try {
						return new r, !1
					} catch (r) {
						return !0
					}
				}
				return !1
			}
		
		
		
			class Multithreading { //多线程
				constructor(arg) {
					if (!Worker) throw Error("the current runtime does not support web worker");
					if (!Promise) throw Error("the current runtime does not support Promise");
				}
				
				add() {
					for (var s = arguments.length, c = Array(s), l = 0; s > l; l++)
						c[l] = arguments[l];
					
					c.forEach(function(r) {
						if ("function" != typeof r) throw Error(r + " should be a function");
						var e = n(r);
						f.set(e, r)
					});
					URL.revokeObjectURL(u);
					
					var d = "",
						p = !0,
						v = !1,
						h = void 0;
					
					var i = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {};
					
					var o = Function.prototype.toString;
					
					try {
						for (var y, m = f.entries()[Symbol.iterator](); !(p = (y = m.next()).done); p = !0) {
							var w = r(y.value, 2),
								g = w[0],
								b = w[1];
							d += t(b) ? ";var " + g + " = " + o.call(b) : ";" + o.call(b)
						}
					}
					catch (r) {
						v = !0, h = r
					}
					finally {
						try {
							!p && m.return && m.return()
						}
						finally {
							if (v) throw h
						}
					}
					u = URL.createObjectURL( new Blob([d + ";\n" + e]) );
					a = new Worker(u, i);
				
				}
				
				invoke() {
					var r = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : "",
						e = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : [];
					
					if (!f.has(r)) throw Error(r + " is not defined");
					
					return new Promise(function(t, n) {
						a.onmessage = function(r) {
							var e = JSON.parse(r.data);
							t(e)
						},
						a.onerror = function(r) {
							n(r.message)
						},
						a.postMessage(JSON.stringify({
							method: r,
							params: e
						}))
					})
				}
				
				terminate() {
					a && (a.terminate(), a = null), URL.revokeObjectURL(u), f.clear()
				}
			}
			
			// function sayName (name) {
			//   return 'Hello ${name}!'
			// }
			
			function sayHi () {
			  return 'Hi!'
			}
			
			async function requestInfo (url, id) {
			    return fetch(url, {id})
			}
			
			(async()=>{
				var multiThread = new Multithreading();
				//multiThread.add(sayName, sayHi)
				multiThread.add(sayHi)
				
				//await multiThread.invoke('sayName', ['naeco'])  // Hello naeco!
				await multiThread.invoke('sayHi') // Hi!
				//await multiThread.invoke('requestInfo', ['api/getUserInfo', 'xxx123456']) //user info...
				console.log("ok");
			})();
			
		</script>
	</head>
	<body>
		
	</body>
</html>